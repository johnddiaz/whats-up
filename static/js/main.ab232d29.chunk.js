(this["webpackJsonpwhats-up"]=this["webpackJsonpwhats-up"]||[]).push([[0],{24:function(e,t,n){e.exports={root:"Avatar_root__3e7La",img:"Avatar_img__9sg0P",badge:"Avatar_badge__3M4IC"}},27:function(e,t,n){e.exports={root:"ChatPreview_root__3PcDC",textRoot:"ChatPreview_textRoot__1HIVj"}},28:function(e,t,n){},30:function(e,t,n){e.exports={root:"Header_root__jsaeH"}},31:function(e,t,n){e.exports={root:"BottomSettings_root__1cJ2q"}},37:function(e,t,n){},39:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){},43:function(e,t,n){},48:function(e,t,n){},53:function(e,t,n){"use strict";n.r(t);var r=n(4),a=n.n(r),o=n(29),s=n.n(o),i=(n(37),n(8)),c=n.n(i),u=n(13),l=n(6),d=(n(39),n(28),n(27)),p=n.n(d),f=n(2);var h=function(e){return Object(f.jsx)("div",{className:p.a.root,onClick:function(){e.onPreviewClick(e.conversation.id)},children:Object(f.jsxs)("div",{className:p.a.textRoot,children:[Object(f.jsx)("h4",{style:{margin:"0 0 8px"},children:e.conversation.name||e.conversation.id}),Object(f.jsx)("p",{style:{margin:"0"},children:e.conversation.otherUsers.length>0?e.conversation.otherUsers.map((function(e,t,n){return 1===n.length||t===n.length-1?e.userName||e.id:"".concat(e.userName||e.id,", ")})):"No users here."})]})})},v=n(5),g=n(24),b=n.n(g);function j(e){var t="sm"===e.size?{height:"28px",width:"28px"}:{height:"36px",width:"36px"},n="sm"===e.size?{height:"8px",width:"8px",marginTop:"-12px",marginLeft:"21px"}:{height:"11px",width:"11px",marginTop:"-14px",marginLeft:"24px"};return Object(f.jsxs)("div",{className:b.a.root,style:Object(v.a)(Object(v.a)({},t),e.style),children:[Object(f.jsx)("img",{src:e.photoURL,alt:"profile pic",className:b.a.img,style:t}),e.badgeState&&Object(f.jsx)("div",{className:b.a.badge,style:Object(v.a)({backgroundColor:"online"===e.badgeState?"#57ba14":"#f9fff5"},n)})]})}var m=n(30),x=n.n(m);function y(e){return Object(f.jsx)("header",{className:x.a.root,children:e.children})}var O=function(e){var t;return Object(f.jsxs)(y,{children:[(null===(t=e.user)||void 0===t?void 0:t.photoURL)&&Object(f.jsx)(j,{photoURL:e.user.photoURL,size:"sm",badgeState:e.userState}),Object(f.jsx)("h3",{style:{marginLeft:"16px",fontSize:"1.3em"},children:"Whats Up"})]})};n(41),n(42);var w=function(e){var t=r.useState(!1),n=Object(l.a)(t,2),a=n[0],o=n[1],s=e.isSender?"interactionmessage-self":"interactionmessage-friend",i=e.placementClass?e.placementClass:"",c={};return e.squishAbove&&(c[e.isSender?"borderTopRightRadius":"borderTopLeftRadius"]="3px"),e.squishBelow&&(c[e.isSender?"borderBottomRightRadius":"borderBottomLeftRadius"]="3px"),console.log(e.message.createdAt),Object(f.jsxs)("div",{className:i,ref:e.newestMessageRef,style:Object(v.a)({display:"flex",flexDirection:"column"},e.marginTop?{marginTop:e.marginTop}:void 0),children:[e.showName&&!e.isSender&&Object(f.jsx)("p",{style:Object(v.a)({marginBottom:"2px",marginTop:"0px",textAlign:e.isSender?"right":"left",fontSize:"12px"},e.isSender?null:{marginLeft:"56px"}),children:e.message.senderName}),Object(f.jsxs)("div",{style:{display:"flex",alignSelf:"right"===e.side?"flex-end":"left"===e.side?"flex-start":void 0},children:[!e.isSender&&e.avatarProps&&Object(f.jsx)("div",{style:{marginRight:"8px",height:"36px",width:"36px"},children:Object(f.jsx)(j,Object(v.a)({},e.avatarProps))}),!e.isSender&&!e.avatarProps&&e.spacePlaceholder&&Object(f.jsx)("div",{style:{marginRight:"8px",height:"36px",width:"36px"}}),Object(f.jsx)("p",{id:"interactionmessage-text",className:s,style:Object(v.a)(Object(v.a)({},c),{},{whiteSpace:"pre-wrap"}),onClick:function(){return o((function(e){return!e}))},children:e.message.content})]}),a&&Object(f.jsx)("p",{style:Object(v.a)(Object(v.a)({marginTop:"4px",textAlign:e.side},e.isSender?{marginRight:"12px"}:{marginLeft:"56px"}),{},{fontSize:"10px",marginBottom:"0px"}),children:new Date(e.message.createdAt).toLocaleString()})]})},k=1e3,S=36e5;function C(e){var t=e.days,n=e.hours,r=e.mins,a=e.secs,o=e.millis,s=0;return t&&(s+=24*t*S),n&&(s+=n*S),r&&(s+=6e4*r),a&&(s+=a*k),o&&(s+=o),s}function N(e){var t=e.millis,n=0;return t&&(n+=t/k),n}var _=function(e){var t=r.useRef(null);return r.useEffect((function(){t.current&&t.current.scrollIntoView({behavior:"smooth"})}),[e.messages.length]),Object(f.jsx)("div",{id:"interaction-root",children:function(){var n=e.messages.reduce((function(e,t,n,r){var a=N({millis:t.createdAt});return n>0&&(r[n-1].sender===t.sender?a-N({millis:r[n-1].createdAt})<60?(e.squishAbove[t.id]=!0,e.marginTop[t.id]="1px"):e.marginTop[t.id]="12px":e.marginTop[t.id]="30px"),r.length>0&&n<r.length-1&&r[n+1].sender===t.sender&&N({millis:r[n+1].createdAt})-a<60&&(e.squishBelow[t.id]=!0,e.messagesWithoutAvatar[t.id]=!0),e}),{squishAbove:{},squishBelow:{},messagesWithoutAvatar:{},marginTop:{}}),a=new Date,o=new Intl.DateTimeFormat("en-US",{weekday:"long"}),s=new Intl.DateTimeFormat("en-US",{month:"short"});return e.messages.map((function(i,c,u){var l=!(!e.userId||e.userId!==i.sender),d=e.statuses[i.sender],p=new Date(i.createdAt),h=!1;if(0===c)h=!0;else{var v=new Date(u[c-1].createdAt);h=0===c||v.toDateString()!==p.toDateString()||v.getTime()>=p.getTime()+C({hours:3})}var g=p.getHours(),b=p.getMinutes();g=g<10?"".concat(0,g):g,b=b<10?"".concat(0,b):b;var j,m="".concat(g,":").concat(b);if(h)if(p.toDateString()===a.toDateString())j="Today";else if(p.toDateString()===new Date(a.getTime()-C({days:1})).toDateString())j="Yesterday";else{var x=C({hours:a.getHours(),mins:a.getMinutes(),secs:a.getSeconds(),millis:a.getMilliseconds()});if(p.getTime()>new Date(a.getTime()-(C({days:6})+x)).getTime())j=o.format(p);else{var y=s.format(p);j="".concat(o.format(p),", ").concat(y," ").concat(p.getDate())}}var O=!!i.photoURL&&!n.messagesWithoutAvatar[i.id];return Object(f.jsxs)(r.Fragment,{children:[h&&j&&Object(f.jsx)("p",{style:{textAlign:"center",marginTop:"30px",marginBottom:"8px"},children:"".concat(j," - ").concat(m)},"tmln-".concat(i.id)),Object(f.jsx)(w,{message:i,newestMessageRef:c===e.messages.length-1?t:void 0,isSender:l,side:l?"right":"left",userStatus:d,spacePlaceholder:!l&&!O,avatarProps:!l&&O?{photoURL:i.photoURL,badgeState:d.state}:void 0,squishAbove:n.squishAbove[i.id],squishBelow:n.squishBelow[i.id],showName:!n.squishAbove[i.id],placementClass:e.userId&&e.userId===i.sender?"interactionmessage-placement-self":"interactionmessage-placement-friend",marginTop:n.marginTop[i.id]},i.id)]},"rf-".concat(i.id))}))}()})};n(43);var U=function(e){return Object(f.jsxs)("div",{id:"interactionmessageeditor-root",children:[Object(f.jsx)("textarea",{onChange:e.handleMessageChange,value:e.currentDraft}),Object(f.jsx)("input",{type:"button",value:"Send",onClick:e.handleSend})]})};function I(e){return Object(f.jsx)("div",{style:{display:"flex",flexDirection:"column",flexGrow:2,flexBasis:0,maxWidth:"700px"},children:e.children})}function R(e){return Object(f.jsx)("div",{style:{display:"flex",flexDirection:"column",backgroundColor:"grey",flexGrow:3,flexBasis:0},children:e.children})}function A(e){return Object(f.jsxs)("div",{style:{height:"100%"},children:[Object(f.jsx)(y,{children:Object(f.jsx)("h3",{style:{marginLeft:"16px",fontSize:"1.3em"},children:"Whats Up"})}),Object(f.jsxs)("div",{style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[Object(f.jsx)("button",{style:{margin:"4px",fontSize:"24px",marginBottom:"16px"},onClick:function(){return e.showSignInPopup("google")},children:"Sign in with Google"}),Object(f.jsx)("button",{style:{margin:"4px",fontSize:"24px"},onClick:function(){return e.showSignInPopup("github")},children:"Sign in with Github"})]})]})}var L=n(9);var T={apiKey:"AIzaSyA51jM6IryfHm1HnzmXo66QQQCcRK1ld0M",authDomain:"whats-up-ce34e.firebaseapp.com",projectId:"whats-up-ce34e",storageBucket:"whats-up-ce34e.appspot.com",messagingSenderId:"6258283268",appId:"1:6258283268:web:91c3f62da6da184d583651",measurementId:"G-K13ZDZ04JX"};function D(){var e=function(e){var t=Object(r.useState)((function(){var t=localStorage.getItem(e);return!!t&&JSON.parse(t)||null})),n=Object(l.a)(t,2),a=n[0],o=n[1];return Object(r.useEffect)((function(){localStorage.setItem(e,JSON.stringify(a))}),[e,a]),[a,o]}("firebaseUser"),t=Object(l.a)(e,2),n=t[0],a=t[1],o=Object(r.useState)(null),s=Object(l.a)(o,2),i=s[0],d=s[1],p=Object(r.useState)(null),f=Object(l.a)(p,2),h=f[0],v=f[1];function g(){return(g=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.a.database().ref("users/".concat(t.uid)).once("value");case 2:if(!e.sent.val()){e.next=8;break}return e.next=6,L.a.database().ref("users/".concat(t.uid)).update({userName:t.displayName,photoURL:t.photoURL});case 6:e.next=11;break;case 8:return console.log("User ".concat(t.uid," does not exist. Creating now.")),e.next=11,L.a.database().ref("users/".concat(t.uid)).set({userName:t.displayName,photoURL:t.photoURL});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(r.useEffect)((function(){0===L.a.apps.length&&L.a.initializeApp(T);var e=new L.a.auth.GithubAuthProvider,t=new L.a.auth.GoogleAuthProvider;d(e),v(t),L.a.auth().onAuthStateChanged((function(e){e?(a(e),function(e){g.apply(this,arguments)}(e)):a(null)}))}),[]),[n,function(e){var t;if("github"===e&&i)t=i;else{if("google"!==e||!h)return;t=h}L.a.auth().signInWithPopup(t).catch((function(e){console.error("Unable to log in with error ".concat(e))}))}]}n(48);var B=function(e){function t(t){t.preventDefault(),e.dispatchForm({type:"toggle_person",payload:t.target.dataset.personid})}return Object(f.jsxs)("div",{id:"InteractionCreator-root",children:[Object(f.jsx)("h4",{style:{marginTop:"0"},children:"Choose a conversation name (optional)"}),Object(f.jsx)("input",{id:"conversation-name-input",type:"text",value:e.formState.newConversationName,onChange:function(t){return e.dispatchForm({type:"set_conversation_name",payload:t.currentTarget.value})}}),Object(f.jsx)("h4",{children:"Select people to add *"}),Object(f.jsx)("div",{children:e.users.filter((function(t){return t.id!==e.userId})).map((function(n){return Object(f.jsxs)("div",{className:"hover",style:{display:"flex",justifyContent:"left",alignItems:"center",minWidth:"20px",userSelect:"none",padding:"8px 16px",border:"1px solid #737373",borderRadius:"3px",marginTop:"8px",backgroundColor:e.formState.peopleForNewConversation.includes(n.id)?"#696969":void 0},"data-personid":n.id,onClick:t,children:[n.photoURL&&Object(f.jsx)(j,{photoURL:n.photoURL,badgeState:e.userStatuses[n.id].state,style:{marginRight:"8px"}}),n.userName]},"pselect-".concat(n.id))}))})]})},P=n(15);var F=n(22),E=n(19);var M=function(e){return Object(f.jsxs)(y,{children:[Object(f.jsx)("div",{onClick:e.back,style:{display:"flex",backgroundColor:"black",color:"white",borderRadius:"5px",cursor:"pointer",padding:"8px 8px 8px 0"},children:Object(f.jsx)(F.a,{icon:E.a,size:"lg"})}),Object(f.jsx)("h3",{style:{marginLeft:"8px"},children:e.conversation.name})]})};function W(e){var t=r.useState(e.displayName),n=Object(l.a)(t,2),a=n[0],o=n[1];return Object(f.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:Object(f.jsxs)("form",{style:{display:"flex",flexDirection:"column",padding:"8px"},onSubmit:function(t){t.preventDefault(),a?e.updateProfile({displayName:a}):console.error("Username was not valid.")},children:[Object(f.jsxs)("div",{style:{display:"flex",padding:"4px",marginBottom:"16px",flexDirection:"column"},children:[Object(f.jsx)("label",{htmlFor:"username-input",style:{paddingBottom:"4px"},children:"Username"}),Object(f.jsx)("input",{id:"username-input",type:"text",placeholder:"Type in the user name",value:a,onChange:function(e){return o(e.target.value)}})]}),Object(f.jsx)("input",{type:"submit",value:"Save"})]})})}function z(e,t){switch(t.type){case"return_to_main":case"select_conversation":return Object(v.a)(Object(v.a)({},e),{},{showConversationForm:!1,showUserSettings:!1});case"show_conversation_form":return Object(v.a)(Object(v.a)({},e),{},{showConversationForm:!0,showUserSettings:!1});case"show_user_settings":return Object(v.a)(Object(v.a)({},e),{},{showConversationForm:!1,showUserSettings:!0});default:return e}}var K=n(21);var q=n(31),J=n.n(q);var G=function(e){return Object(f.jsx)("div",{className:J.a.root,children:Object(f.jsx)("button",{onClick:e.logOut,children:"Log Out"})})};function H(e,t){switch(t.type){case"set_conversation_name":return Object(v.a)(Object(v.a)({},e),{},{newConversationName:t.payload});case"toggle_person":return e.peopleForNewConversation.includes(t.payload)?Object(v.a)(Object(v.a)({},e),{},{peopleForNewConversation:e.peopleForNewConversation.filter((function(e){return e!==t.payload}))}):Object(v.a)(Object(v.a)({},e),{},{peopleForNewConversation:[].concat(Object(P.a)(e.peopleForNewConversation),[t.payload])});default:return e}}var V=n(32);function Q(e,t){return X.apply(this,arguments)}function X(){return(X=Object(u.a)(c.a.mark((function e(t,n){var r,a,o,s,i,u,l,d,p,f;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.name,0!==(a=t.peopleToAdd).length){e.next=4;break}return console.error("no friends to add"),e.abrupt("return",null);case 4:return e.prev=4,o=L.a.database(),e.next=8,Promise.all(a.map((function(e){return o.ref("users/".concat(e)).once("value")})));case 8:s=e.sent,i=Object(V.a)(s),e.prev=10,i.s();case 12:if((u=i.n()).done){e.next=19;break}if((l=u.value).val()){e.next=17;break}return alert("Friend ID ".concat(l.key," does not exist.")),e.abrupt("return",null);case 17:e.next=12;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(10),i.e(e.t0);case 24:return e.prev=24,i.f(),e.finish(24);case 27:return e.next=29,o.ref("conversations").push();case 29:return d=e.sent,p=d.key,e.next=33,d.set({createdAt:L.a.database.ServerValue.TIMESTAMP,creatorId:n,name:r});case 33:return(f={})["userConversations/".concat(n.uid,"/").concat(p)]={invitedBy:n.uid},f["conversationUsers/".concat(p,"/").concat(n.uid)]={invitedBy:n.uid,userName:n.displayName},s.forEach((function(e){f["userConversations/".concat(e.key,"/").concat(p)]={invitedBy:n.uid},f["conversationUsers/".concat(p,"/").concat(e.key)]={invitedBy:n.uid,userName:e.child("userName").val()||""}})),e.next=39,o.ref().update(f);case 39:return e.abrupt("return",p);case 42:return e.prev=42,e.t1=e.catch(4),alert("something went wrong: ".concat(e.t1)),e.abrupt("return",null);case 46:case"end":return e.stop()}}),e,null,[[4,42],[10,21,24,27]])})))).apply(this,arguments)}function Z(e,t,n){return Y.apply(this,arguments)}function Y(){return(Y=Object(u.a)(c.a.mark((function e(t,n,r){var a,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={sender:t.uid,senderName:t.displayName||"",createdAt:L.a.database.ServerValue.TIMESTAMP,content:n,photoURL:t.photoURL},e.next=3,L.a.database().ref("messages/".concat(r)).push();case 3:return o=e.sent,e.abrupt("return",o.set(a));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(){return ee.apply(this,arguments)}function ee(){return(ee=Object(u.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",L.a.auth().signOut());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var te,ne=(te=function(e){var t,n,o,s,i,d=L.a.apps.length>0,p=function(e,t){var n=Object(r.useState)([]),a=Object(l.a)(n,2),o=a[0],s=a[1],i=Object(r.useState)(null),d=Object(l.a)(i,2),p=d[0],f=d[1],h=Object(r.useState)([]),g=Object(l.a)(h,2),b=g[0],j=g[1];return Object(r.useEffect)((function(){try{if(!e||!t)return;var n=L.a.database(),r="userConversations/".concat(t),a=n.ref(r);return Object(u.a)(c.a.mark((function e(){var r,o,i,u,l,d,p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.orderByKey().once("value");case 2:if(r=e.sent,o=[],i="",!r.exists()){e.next=20;break}return u=[],l=[],r.forEach((function(e){u.push(n.ref("conversations/".concat(e.key)).orderByKey().once("value")),l.push(n.ref("conversationUsers/".concat(e.key)).orderByKey().once("value"))})),e.next=11,Promise.all(u);case 11:return d=e.sent,e.next=14,Promise.all(l);case 14:p=e.sent,r.forEach((function(e){if(e.key){var n={id:e.key,otherUsers:[],name:""},r=d.find((function(t){return t.ref.key===e.key})),a=p.find((function(t){return t.ref.key===e.key}));r&&(n.name=r.val().name),a&&a.forEach((function(e){e.key&&e.key!==t&&n.otherUsers.push({id:e.key,userName:e.child("userName").val()})})),o.push(n)}})),s(o),i=o.length>0?o[o.length-1].id:"",e.next=22;break;case 20:s([]),f(null);case 22:a.orderByKey().startAfter(i).on("child_added",(function(e,r){var a=e.key;if(a){var o={id:a,otherUsers:[],name:""};n.ref("conversations/".concat(a)).orderByKey().once("value").then((function(e){o.name=e.val().name,n.ref("conversationUsers/".concat(a)).orderByKey().once("value").then((function(e){e.forEach((function(e){e.key&&e.key!==t&&o.otherUsers.push({id:e.key,userName:e.child("userName").val()})})),s((function(e){return[].concat(Object(P.a)(e),[o])}))}))}))}}));case 23:case"end":return e.stop()}}),e)})))(),function(){a.off("child_added")}}catch(o){return void console.error(o)}}),[e,t]),Object(r.useEffect)((function(){try{if(!e||!t||!p)return;var n=L.a.database(),r="messages/".concat(p),a=n.ref(r);return Object(u.a)(c.a.mark((function e(){var t,n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.orderByKey().once("value");case 2:t=e.sent,n=[],t.exists()?(t.forEach((function(e){if(e.key){var t=e.toJSON();n.push(Object(v.a)(Object(v.a)({},t),{},{id:e.key}))}})),j(n)):j([]),r=n.length>0?n[n.length-1].id:"",a.orderByKey().startAfter(r).on("child_added",(function(e,t){if(e.key){var n=e.toJSON(),r=Object(v.a)(Object(v.a)({},n),{},{id:e.key});j((function(e){return[].concat(Object(P.a)(e),[r])}))}}));case 7:case"end":return e.stop()}}),e)})))(),function(){a.off("child_added")}}catch(o){console.error(o)}}),[e,t,p]),{messages:b,conversations:o,conversationId:p,setConversationId:f}}(d,null===(t=e.user)||void 0===t?void 0:t.uid),g=p.messages,b=p.conversations,j=p.conversationId,m=p.setConversationId,x=j?b.find((function(e){return e.id===j})):null,w=function(e,t){var n=r.useState({}),a=Object(l.a)(n,2),o=a[0],s=a[1],i=r.useState([]),d=Object(l.a)(i,2),p=d[0],f=d[1];return r.useEffect((function(){if(e&&t){var n=L.a.database(),r=n.ref("/status/"+t),a=n.ref(".info/connected"),o={state:"offline",lastChanged:L.a.database.ServerValue.TIMESTAMP},s={state:"online",lastChanged:L.a.database.ServerValue.TIMESTAMP};return a.on("value",(function(e){e.val()&&r.onDisconnect().set(o).then((function(){r.set(s)}))})),function(){a.off("value")}}}),[e,t]),r.useEffect((function(){if(e){var t=L.a.database(),n=t.ref("/status");return Object(u.a)(c.a.mark((function e(){var r,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="",a={},e.next=4,t.ref("/status").orderByKey().once("value");case 4:e.sent.forEach((function(e){e.key&&(r=e.key,a[e.key]={state:e.child("state").val(),lastChanged:e.child("lastChanged").val()})})),s(a),n.startAfter(r).on("child_added",(function(e){var t=e.key;t&&s((function(n){return Object(v.a)(Object(v.a)({},n),{},Object(K.a)({},t,{state:e.child("state").val(),lastChanged:e.child("lastChanged").val()}))}))})),n.on("child_changed",(function(e){var t=e.key;t&&s((function(n){return Object(v.a)(Object(v.a)({},n),{},Object(K.a)({},t,{state:e.child("state").val(),lastChanged:e.child("lastChanged").val()}))}))}));case 9:case"end":return e.stop()}}),e)})))(),function(){n.off("child_added"),n.off("child_changed")}}}),[e]),r.useEffect((function(){if(e){var t=L.a.database(),n=t.ref("/users");return Object(u.a)(c.a.mark((function e(){var r,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="",a=[],e.next=4,t.ref("/users").orderByKey().once("value");case 4:e.sent.forEach((function(e){e.key&&(r=e.key,a.push({id:e.key,userName:e.child("userName").val(),photoURL:e.child("photoURL").val()}))})),f(a),n.startAfter(r).on("child_added",(function(e){var t=e.key;t&&f((function(n){return[].concat(Object(P.a)(n),[{id:t,userName:e.child("userName").val(),photoURL:e.child("photoURL").val()}])}))})),n.on("child_changed",(function(e){var t=e.key;t&&f((function(n){var r=Object(P.a)(n),a=r.find((function(e){return e.id===t}));return a&&(a.userName=e.child("userName").val(),a.photoURL=e.child("photoURL").val()),r}))}));case 9:case"end":return e.stop()}}),e)})))(),function(){n.off("child_added"),n.off("child_changed")}}}),[e]),[p,o]}(d,null===(n=e.user)||void 0===n?void 0:n.uid),k=Object(l.a)(w,2),S=k[0],C=k[1],N=function(){var e=Object(r.useState)((function(){return o(window.innerWidth)})),t=Object(l.a)(e,2),n=t[0],a=t[1];function o(e){return e>=1920?"xl":e>=1280?"lg":e>=960?"md":e>=700?"sm":"xs"}return Object(r.useEffect)((function(){function e(){var e=window.innerWidth;a(o(e))}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}(),A=a.a.useState(""),T=Object(l.a)(A,2),D=T[0],q=T[1],J=function(){var e=Object(r.useReducer)(z,{showConversationForm:!1,showUserSettings:!1}),t=Object(l.a)(e,2);return[t[0],t[1]]}(),V=Object(l.a)(J,2),X=V[0],Y=V[1],ee=function(){var e=Object(r.useReducer)(H,{newConversationName:"",peopleForNewConversation:[]}),t=Object(l.a)(e,2);return[t[0],t[1]]}(),te=Object(l.a)(ee,2),ne=te[0],re=te[1];function ae(e){oe({type:"select_conversation",conversationId:e})}function oe(e){Y({type:e.type}),m(e.conversationId||null)}function se(){return(se=Object(u.a)(c.a.mark((function t(){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.user&&d){t.next=3;break}return console.error("not logged in"),t.abrupt("return");case 3:return t.next=5,Q({name:ne.newConversationName,peopleToAdd:ne.peopleForNewConversation},e.user);case 5:(n=t.sent)&&oe({type:"select_conversation",conversationId:n});case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ie(){return(ie=Object(u.a)(c.a.mark((function t(n){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),e.user&&d){t.next=6;break}return console.error("not logged in"),t.abrupt("return");case 6:if(j){t.next=9;break}return console.error("no conversation selected"),t.abrupt("return");case 9:return t.prev=9,t.next=12,Z(e.user,D,j);case 12:q(""),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(9),alert("something went wrong... ".concat(t.t0));case 18:case"end":return t.stop()}}),t,null,[[9,15]])})))).apply(this,arguments)}function ce(){return(ce=Object(u.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,$();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("unable to log out: ".concat(e.t0));case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}function ue(){oe({type:"return_to_main"})}var le="xs"!==N||"xs"===N&&(j||X.showConversationForm||X.showUserSettings),de="xs"!==N||"xs"===N&&!j&&!X.showConversationForm&&!X.showUserSettings;return Object(f.jsxs)("div",{id:"app-root",children:[de&&Object(f.jsxs)(I,{children:[Object(f.jsx)(O,{user:e.user,userState:e.user&&(null===(o=C[e.user.uid])||void 0===o?void 0:o.state)}),Object(f.jsxs)("div",{onClick:function(e){e.preventDefault(),oe({type:"show_conversation_form"})},className:"hover",style:{margin:"16px 0",padding:"8px 16px",display:"flex",alignItems:"center",justifyContent:"center"},children:["New conversation",Object(f.jsx)("div",{style:{display:"flex",height:"32px",width:"32px",backgroundColor:"black",alignItems:"center",justifyContent:"center",color:"white",borderRadius:"5px",marginLeft:"8px"},children:Object(f.jsx)(F.a,{icon:E.b,size:"sm"})})]}),Object(f.jsx)("div",{style:{height:"100%",padding:"0px 0px 16px"},children:Object(f.jsx)("div",{children:Object(f.jsx)("div",{style:{overflow:"auto"},children:b.map((function(e){return Object(f.jsx)(h,{conversation:e,onPreviewClick:ae},e.id)}))})})}),Object(f.jsx)(G,{logOut:function(){return ce.apply(this,arguments)},openUserSettings:function(e){e.preventDefault(),oe({type:"show_user_settings"})}})]}),le&&Object(f.jsx)(R,{children:x&&e.user?Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(M,{backIcon:"xs"===N?"<":"X",back:ue,conversation:x}),Object(f.jsx)(_,{userId:e.user.uid,conversation:x,messages:g,statuses:C}),Object(f.jsx)(U,{currentDraft:D,handleMessageChange:function(e){e.preventDefault(),q(e.target.value)},handleSend:function(e){return ie.apply(this,arguments)}})]}):X.showConversationForm?Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)(y,{children:[Object(f.jsx)("div",{onClick:ue,style:{display:"flex",backgroundColor:"black",color:"white",borderRadius:"5px",cursor:"pointer",padding:"8px 8px 8px 0"},children:Object(f.jsx)(F.a,{icon:E.a,size:"lg"})}),Object(f.jsx)("h3",{style:{marginLeft:"8px"},children:"New conversation"}),Object(f.jsx)("div",{onClick:function(){return se.apply(this,arguments)},style:{cursor:"pointer",padding:"8px 0 8px 8px",marginLeft:"auto"},children:"Create"})]}),Object(f.jsx)(B,{userId:null===(s=e.user)||void 0===s?void 0:s.uid,users:S,userStatuses:C,formState:ne,dispatchForm:re})]}):X.showUserSettings?Object(f.jsx)(W,{displayName:(null===(i=e.user)||void 0===i?void 0:i.displayName)||"",updateProfile:function(t){var n;null===(n=e.user)||void 0===n||n.updateProfile(t).catch((function(e){alert("user profile not updated with error ".concat(e))}))}}):null})]})},function(e){var t=D(),n=Object(l.a)(t,2),r=n[0],a=n[1];return r?Object(f.jsx)(te,Object(v.a)({user:r},e)):Object(f.jsx)(A,{showSignInPopup:a})}),re=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ae(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var oe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,54)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,o=t.getLCP,s=t.getTTFB;n(e),r(e),a(e),o(e),s(e)}))};s.a.render(Object(f.jsx)(a.a.StrictMode,{children:Object(f.jsx)(ne,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/whats-up",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/whats-up","/service-worker.js");re?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ae(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):ae(t,e)}))}}(),oe()}},[[53,1,2]]]);
//# sourceMappingURL=main.ab232d29.chunk.js.map